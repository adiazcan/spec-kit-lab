# Data Model: Character Management Interface

**Feature**: 008-char-mgmt-ui  
**Date**: January 30, 2026  
**Based on**: Research decisions and specification requirements

---

## Frontend Data Structures

### Character (Domain Model)

Represents a player character with D&D 5E attributes and calculated modifiers.

```typescript
interface Character {
  // Identity
  id: string; // UUID from backend
  name: string; // 1-50 characters
  adventureId: string; // Foreign key to adventure

  // Base Attributes (3-18 range)
  attributes: {
    str: number; // Strength
    dex: number; // Dexterity
    int: number; // Intelligence
    con: number; // Constitution
    cha: number; // Charisma
  };

  // Calculated Modifiers (derived from attributes)
  modifiers: {
    str: number; // Floor((str - 10) / 2)
    dex: number;
    int: number;
    con: number;
    cha: number;
  };

  // Metadata
  createdAt: string; // ISO 8601 timestamp
  updatedAt: string; // ISO 8601 timestamp
}
```

**Validation Rules**:

- `id`: Must be valid UUID (generated by backend)
- `name`: Non-empty, at least 1 non-whitespace character, max 50 characters
- Each attribute: Must be integer between 3 and 18 (inclusive)
- `adventureId`: Must reference existing adventure

**State Transitions**:

- Created via POST /api/characters (point-buy or dice roll)
- Readable via GET /api/characters/{id}
- Updatable via PUT /api/characters/{id} (edit in context menu)
- Deletable via DELETE /api/characters/{id} (with confirmation)

---

### CharacterFormData (Form State Model)

Represents form input during character creation or editing. Includes intermediate state not yet persisted.

```typescript
interface CharacterFormData {
  // Basic Info
  name: string; // User input, can be empty until submission
  adventureId: string; // Pre-set for character creation

  // Attribute Allocation
  attributes: {
    str: number;
    dex: number;
    int: number;
    con: number;
    cha: number;
  };

  // Form State
  mode: "point-buy" | "dice-roll"; // Creation method

  // Point-Buy Specific
  pointBuyState?: {
    pointsAvailable: number; // Starting: 27, updated as user allocates
    pointCosts: Record<number, number>; // 8→1pt, 9→1pt, ..., 17→3pts, 18→4pts
  };

  // Dice Roll Specific
  diceRollState?: {
    rolledAttributes: Set<keyof Attributes>; // Track which attributes rolled
  };

  // Validation
  errors: Record<string, string>; // Field-level error messages
  isDirty: boolean; // Has form been modified?
  isValid: boolean; // All validations pass?
}
```

**Key Differences from Persisted Character**:

- Doesn't have `id` (auto-generated on save)
- Has transient `mode` and state tracking fields
- `attributes` can be partial during editing
- Includes `errors` for displaying validation messages

---

### CharacterListItem (List Display Model)

Simplified character summary for list views.

```typescript
interface CharacterListItem {
  id: string;
  name: string;
  attributes: {
    // Only used for summary display
    str: number;
    dex: number;
    int: number;
    con: number;
    cha: number;
  };
  createdAt: string;

  // Summary computed properties (readonly)
  attributeSummary?: string; // e.g., "STR 14, DEX 12, INT 18..."
  highestModifier?: number; // Max modifier for quick stat assessment
}
```

**Computed Properties**:

- `attributeSummary`: Truncated display of top 2-3 attributes
- `highestModifier`: Largest single modifier (visual indicator)

---

### DiceRoll (Dice Rolling Model)

Represents a single d6 roll for attribute generation.

```typescript
interface DiceRoll {
  // Individual dice
  dice: [number, number, number, number]; // Four d6 results

  // Derived values
  dropped: number; // Index of dropped die (0-3)
  sum: number; // Final value (3-18)

  // Metadata
  timestamp: number; // Milliseconds for animation timing
}
```

**Calculation Logic**:

- Generate 4 random numbers 1-6
- Find index of minimum value
- Sum the three highest values
- Store complete roll history for display

---

### AttributeModifierCache (Performance Optimization)

Lookup table for point-buy costs (optional optimization).

```typescript
const POINT_BUY_COSTS: Record<number, number> = {
  8: 0, // Starting value (free)
  9: 1,
  10: 1,
  11: 1,
  12: 1,
  13: 1,
  14: 2,
  15: 2,
  16: 3,
  17: 3,
  18: 4,
};

const MODIFIER_MAP: Record<number, number> = {
  3: -4,
  4: -3,
  5: -3,
  6: -2,
  7: -2,
  8: -1,
  9: -1,
  10: 0,
  11: 0,
  12: 1,
  13: 1,
  14: 2,
  15: 2,
  16: 3,
  17: 3,
  18: 4,
};
```

**Purpose**: Avoid recalculating modifiers repeatedly, ensures consistency

---

## Component-to-Data Mapping

### CharacterForm Component

**Input Props**:

- `character?: Character` (edit mode)
- `adventureId: string` (create mode)
- `onSubmit: (data: CharacterFormData) => Promise<void>`
- `onCancel: () => void`

**Internal State** (via useCharacterForm hook):

- `formData: CharacterFormData`
- `errors: Record<string, string>`
- `isSubmitting: boolean`

**Data Dependencies**:

- None (no API calls during form editing, only in onSubmit)

---

### CharacterSheet Component

**Input Props**:

- `character: Character` (required)
- `onEdit: () => void`
- `onDelete: () => void`

**Internal State**: None (pure display component)

**Data Dependencies**:

- Displays complete `Character` object

---

### CharacterList Component

**Input Props**:

- `characters: CharacterListItem[]`
- `onSelect: (id: string) => void`
- `onDelete: (id: string) => Promise<void>`

**Internal State**:

- `selectedId?: string`
- `deletingIds: Set<string>` (for loading state)

**Data Dependencies**:

- Array of `CharacterListItem` (summary data)

---

### DiceRollMode Component

**Input Props**:

- `attribute: keyof Attributes`
- `currentValue?: number`
- `onRoll: (result: number) => void`

**Internal State**:

- `diceRoll?: DiceRoll` (current roll display)
- `isRolling: boolean` (animation state)

**Data Dependencies**:

- None (generates random numbers internally)

---

### PointBuyMode Component

**Input Props**:

- `attributes: Attributes`
- `pointsAvailable: number`
- `onAttributeChange: (attribute: keyof Attributes, newValue: number) => void`

**Internal State**:

- Managed by parent (form level)

**Data Dependencies**:

- `POINT_BUY_COSTS` lookup table

---

## Data Flow Patterns

### Create Character (Point-Buy)

```
User Input
  ↓
CharacterForm (point-buy mode)
  ↓ [validateForm]
CharacterFormData
  ↓ [onSubmit]
characterApi.createCharacter(formData)
  ↓ [POST /api/characters]
Backend
  ↓ [creates record, calculates modifiers]
Character (with id)
  ↓ [navigate to sheet]
CharacterSheet (displays Character)
```

**Data Transformations**:

1. Form input → CharacterFormData
2. CharacterFormData → API request (POST /api/characters)
3. API response → Character domain model
4. Character → CharacterSheet display

---

### Create Character (Dice Roll)

```
User clicks "Roll"
  ↓
DiceRollMode component
  ↓ [Math.random() × 4]
DiceRoll { dice, sum }
  ↓ [display + store]
User views result
  ↓
User confirms all attributes rolled
  ↓
CharacterFormData (with rolled values)
  ↓ [same as point-buy from here]
```

---

### Edit Character

```
CharacterSheet (displaying Character)
  ↓ [user clicks Edit]
CharacterForm (pre-populated from Character)
  ↓ [modify attributes]
CharacterFormData (dirty)
  ↓ [onSubmit]
characterApi.updateCharacter(id, formData)
  ↓ [PUT /api/characters/{id}]
Backend
  ↓ [updates, recalculates modifiers]
Updated Character
  ↓ [refresh sheet]
CharacterSheet (updated view)
```

---

### Character Selection (Adventure)

```
CharacterSelector component
  ↓ [fetch list]
characterApi.getAdventureCharacters(adventureId)
  ↓ [GET /api/adventures/{adventureId}/characters]
Character[]
  ↓ [convert to ListItems]
CharacterListItem[]
  ↓ [render list]
User selects character
  ↓ [user confirms]
characterApi.selectCharacter(adventureId, characterId)
  ↓ [backend associates character with adventure]
Success
  ↓ [navigate to adventure]
AdventurePage
```

---

## Validation Rules Summary

| Field     | Type     | Range      | Rules                    | Error Message                           |
| --------- | -------- | ---------- | ------------------------ | --------------------------------------- |
| `name`    | string   | 1-50 chars | Required, non-whitespace | "Character name is required"            |
| `str`     | integer  | 3-18       | Integer only             | "Strength must be 3-18"                 |
| `dex`     | integer  | 3-18       | Integer only             | "Dexterity must be 3-18"                |
| `int`     | integer  | 3-18       | Integer only             | "Intelligence must be 3-18"             |
| `con`     | integer  | 3-18       | Integer only             | "Constitution must be 3-18"             |
| `cha`     | integer  | 3-18       | Integer only             | "Charisma must be 3-18"                 |
| Point-Buy | numeric  | 0+         | Sum of costs ≤ 27        | "You have exceeded the point budget"    |
| Dice Roll | nullable | 3-18       | All attributes required  | "Roll all attributes before submitting" |

---

## Performance Considerations

### Modifier Calculation

- **Approach**: Pure function, O(1) lookup
- **Cost**: <1ms per calculation
- **Caching**: Store result in component state, only recalculate on attribute change

### Point-Buy Validation

- **Approach**: Precalculate points spent, check against budget
- **Cost**: <1ms per update
- **Optimization**: Validate incrementally as user changes values

### Character List Rendering

- **Approach**: Use React.memo() to prevent unnecessary re-renders
- **Cost**: O(n) where n = number of characters
- **Optimization**: Virtualization for 50+ characters (future enhancement)

---

**Data Model Complete**  
**Ready for Contract Definition**
